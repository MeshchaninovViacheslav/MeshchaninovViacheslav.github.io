<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Scalable emulation of protein equilibrium ensembles with generative deep learning | Viacheslav Meshchaninov </title> <meta name="author" content="Viacheslav Meshchaninov"> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%9A%80&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://meshchaninovviacheslav.github.io/notes/bio-informatics/structural%20ensembles/lewis2024scalable/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <link rel="preconnect" href="https://fonts.googleapis.com"> <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin> <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet"> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top py-3 py-md-4" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-bold" href="/" style="font-size: 1.125rem; letter-spacing: -0.025em;"> <span class="font-weight-bold">Viacheslav</span> Meshchaninov </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link text-sm font-weight-medium ml-md-4 " href="/">about </a> </li> <li class="nav-item "> <a class="nav-link text-sm font-weight-medium ml-md-4 " href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link text-sm font-weight-medium ml-md-4 text-primary" href="/notes/">notes <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link text-sm font-weight-medium ml-md-4 " href="/cv/">cv </a> </li> <li class="nav-item ml-md-4"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container ml-md-4"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <article class="post"> <header class="post-header"> <h1 class="post-title">Scalable emulation of protein equilibrium ensembles with generative deep learning</h1> <div class="post-authors text-muted"></div> <div class="post-venue text-muted font-italic mb-3"> </div> <p class="post-meta">December 5, 2024</p> <div class="buttons mt-3 mb-4"> <a class="btn btn-primary" href="https://www.biorxiv.org/content/10.1101/2024.12.05.626885v2.full.pdf" role="button" target="_blank" rel="noopener noreferrer"> <i class="fa-solid fa-file-pdf"></i> PDF </a> <a class="btn btn-primary" href="https://github.com/microsoft/bioemu" role="button" target="_blank" rel="noopener noreferrer"> <i class="fa-brands fa-github"></i> Code </a> </div> <div class="post-tags"> <span class="badge badge-secondary">ensembles</span> <span class="badge badge-secondary">proteins</span> </div> </header> <div class="post-content mt-4"> <h2 id="motivation">Motivation</h2> <hr> <p>Protein science can be characterized by three pillars of understanding: sequence, structure, and function.</p> <ul> <li> <strong>Sequence</strong> refers to the linear order of amino acids in the protein chain.</li> <li> <strong>Structure</strong> means the three-dimensional conformation (how the chain folds and organizes in space).</li> <li> <strong>Function</strong> describes what the protein does biologically (e.g., catalyzing a reaction, binding a ligand, transmitting a signal).</li> </ul> <p><strong>Function</strong>, being emerged from sequence and structure, is considered separately because:</p> <ul> <li>Two proteins can have similar folds (structural homology) but do very different things.</li> <li>Conversely, very different folds can evolve to perform similar functions (convergent evolution).</li> <li>Even subtle dynamic features, like conformational changes, can determine what a protein does.</li> <li>Function depends not only on static structure but on interactions with other molecules, post-translational modifications, cellular localization, and dynamics.</li> <li>For example: hemoglobin and myoglobin are structurally related but differ dramatically in oxygen transport vs. storage.</li> </ul> <p><strong>Functional descriptions</strong> such as “actin builds up muscle fibers” are human-made attributions that arise from objectively measurable mechanistic properties:</p> <ul> <li>What are the conformational states (i.e., sets of different structures) a protein can be in?</li> <li>Which other molecules can a protein bind to in these different conformations?</li> <li>What is the probability of these conformational and binding states at a given set of experimental conditions?</li> </ul> <h2 id="methodology">Methodology</h2> <hr> <p>The entire pipeline consists of the following steps:</p> <ol> <li>The authors train a conditional Riemannian diffusion model on the coordinates of $C_{\alpha}$ atoms.</li> <li>As a condition, the diffusion model receives a sequence embedding, which is derived from AlphaFold.</li> </ol> <h3 id="diffusion-model">Diffusion Model</h3> <p><img src="/assets/notes-img/bio-informatics/structural%20ensembles/lewis2024scalable/28.png" alt="folding" width="800px" class="img-frame-black"></p> <h3 id="protein-sequence-encoder">Protein Sequence Encoder</h3> <p>The protein sequence $S$ is encoded through the protein sequence encoder to compute single and pair representations using a simplified version of AlphaFold2.</p> <p><img src="/assets/notes-img/bio-informatics/structural%20ensembles/lewis2024scalable/27.png" alt="folding" width="800px" class="img-frame-black"></p> <h2 id="training-methodology">Training Methodology</h2> <ol> <li>The authors first train on a synthetic dataset derived from AFDB, with high sequence diversity and varied conformations for each sequence. The pretrained model can predict diverse conformations for the same protein sequence, but does not quantitatively match the probabilities of different states.</li> <li>That’s why they fine-tune on 95% MD simulation data and folding free energy measurements, mixed with 5% AFDB structures.</li> </ol> <h3 id="data-splitting">Data Splitting</h3> <p>Having defined a list of test proteins, authors removed from training and validation data any protein whose sequence was similar to any test protein’s sequence. Specifically, they used the mmseqs2 software (version 15.6f452) and removed proteins if they have 40% or higher sequence similarity with any test protein of at least 20 residues in size, using the highest sensitivity parameter supported by the software.</p> <h3 id="pre-training-on-afdb">Pre-training on AFDB</h3> <p>Preprocessing steps:</p> <ol> <li>Using mmseqs Cluster all sequences of AFDB at $80%$ sequence identity and $70%$ coverage, resulting in a set containing more than <strong>93 million clusters</strong>.</li> <li>Get a set of sequence clusters with 80% sequence similarity within each cluster and at most 30% sequence similarity between the centroids of different clusters. To do this they</li> </ol> <ul> <li>Cluster all the centroids of these clusters at $30%$ sequence identity.</li> <li>Leave only one centroid and its corresponding cluster in the entire centroid-cluster (typically the largest cluster). Intuitively: If several 80% clusters are similar, one representative is sufficient: the others carry almost the same information and can be discarded.</li> <li>Discard sequence clusters with fewer than 10 members, leaving roughly <strong>1.4 million sequence cluster</strong>.</li> </ul> <ol> <li>Then they perform <strong>structure-based</strong> clustering.</li> </ol> <ul> <li>They cluster each sequence cluster using foldseek with a sequence identity threshold of $70%$ at $90%$ coverage.</li> <li>Then they discarded everything except the representative member of each structure cluster, leaving a few structure representatives for each sequence cluster.</li> <li>Then they discarded all sequence cluster with single structure representative and those where all the structure representatives were disordered (defined as being composed of more than 50% coil in their secondary structure).</li> <li>To exclude similar structure with missing regions which were flagged incorrectly they discarded structure representative if it has TM-score greater than $0.9$ to another structure representative.</li> <li>They additionally remove sequence clusters lacking at least one structure representative with pLDDT greater than 80, and with a pLDDT standard deviation lower than 15 across residues.</li> </ul> <p>After running this pipeline, they had∼50k sequence clusters with structural diversity.</p> <p>To draw training examples from this dataset, we randomly select a sequence cluster, and then a structure from within that cluster.</p> <p>While the structure is randomly selected, we always use the sequence associated with the highest pLDDT structure in the cluster as input to the model. This effectively creates a mapping from a sequence to multiple structures.</p> <h3 id="finetuning">Finetuning</h3> <p>The authors collect a bunch of datasets from molecular dynamic and finetune their model on this data. They sampled from each finetuning dataset qwith predefined probability. By finetuning was done in the same way as pretraining.</p> <p>So on this stage they just git a model that could sample diverse structures for single sequence but without need probability.</p> <h3 id="metrics">Metrics</h3> <h4 id="coverage">Coverage</h4> <p><strong>Intuition:</strong></p> <p>Imagine you have a set of “target points”—these are the experimental 3-D conformations of the same protein. You generate a thousand (or more) predicted structures—these are the “darts.” The coverage metric answers the question: “How many of the reference targets have at least a few darts landing sufficiently close?”</p> <p><strong>How It Is Calculated:</strong></p> <ol> <li> <strong>Select a Proximity Metric:</strong> Typically, this is RMSD, but it could also be TM-score, contact map, etc.</li> <li> <strong>Evaluate Each Reference Conformation:</strong> For each reference conformation, examine all predicted samples to find if any are within the chosen distance threshold.</li> <li> <strong>Avoid Random Matches:</strong> To ensure a match isn’t random, at least 0.1% of samples (i.e., ≥ 1 out of ~1000) must be within the threshold. If there are 10,000 samples, at least 10 “hits” are required.</li> <li> <strong>Determine Coverage:</strong> If the condition is met, the conformation is considered covered. Coverage is calculated as the number of covered conformations divided by the total number of reference conformations.</li> </ol> <p>This process yields a coverage-versus-threshold curve: the stricter the threshold (lower RMSD), the harder it is to “cover” all targets, resulting in lower coverage.</p> <h2 id="evaluation">Evaluation</h2> <hr> <div style="float: right; margin-left: 1.5em; width: 35%;"> <p><img src="/assets/notes-img/bio-informatics/structural%20ensembles/lewis2024scalable/29.png" alt="folding" width="300px" class="img-frame-black"></p> </div> <p>The authors assess whether BioEmu can qualitatively sample biologically relevant conformations and compare it to AFCluster and AlphaFlow baselines. They created a challenging test set, OOD60, consisting of 19 proteins with strict sequence similarity limits (60% and 40%) to AlphaFold2 and their training data. OOD60 includes difficult cases such as large conformational changes due to binding. Although predicting all these changes with a single-domain model is uncertain, BioEmu shows much better performance than the baselines in generalization benchmarks.</p> <div style="clear: both;"></div> <div class="bibtex-toggle"> <a href="#" class="bib-toggle-link">view bibtex</a> </div> <div class="bibtex-content" style="display: none"> <pre><code>@article{lewis2024scalable,
  title={Scalable emulation of protein equilibrium ensembles with generative deep learning},
  author={Lewis, Sarah and Hempel, Tim and Jim{\'e}nez-Luna, Jos{\'e} and Gastegger, Michael and Xie, Yu and Foong, Andrew YK and Satorras, Victor Garc{\'\i}a and Abdin, Osama and Veeling, Bastiaan S and Zaporozhets, Iryna and others},
  journal={bioRxiv},
  pages={2024--12},
  year={2024},
  publisher={Cold Spring Harbor Laboratory}
}</code></pre> </div> </div> </article> <script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggleLink = document.querySelector(".bib-toggle-link");
    if (toggleLink) {
      toggleLink.addEventListener("click", function (e) {
        e.preventDefault();
        const bibContent = document.querySelector(".bibtex-content");
        if (bibContent.style.display === "none") {
          bibContent.style.display = "block";
          toggleLink.textContent = "hide bibtex";
        } else {
          bibContent.style.display = "none";
          toggleLink.textContent = "view bibtex";
        }
      });
    }
  });
</script> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Viacheslav Meshchaninov. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. Last updated: July 20, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>